<launch>

  <arg name="launch_driver" default="true" />

  <group ns="lidar">

    <group ns="top">
      <include file="$(find sensing_launch)/launch/velodyne_VLP32C.launch">
        <arg name="sensor_frame" default="velodyne_top" />
        <arg name="device_ip" value="192.168.1.201"/>
        <arg name="port" value="2368"/>
        <arg name="launch_driver" value="$(arg launch_driver)" />
      </include>
    </group>

    <group ns="left">
      <include file="$(find sensing_launch)/launch/velodyne_VLP16.launch">
        <arg name="sensor_frame" default="velodyne_left" />
        <arg name="device_ip" value="192.168.1.202"/>
        <arg name="port" value="2369"/>
        <arg name="launch_driver" value="$(arg launch_driver)" />
      </include>
    </group>

    <group ns="right">
      <include file="$(find sensing_launch)/launch/velodyne_VLP16.launch">
        <arg name="sensor_frame" default="velodyne_right" />
        <arg name="device_ip" value="192.168.1.203"/>
        <arg name="port" value="2370"/>
        <arg name="launch_driver" value="$(arg launch_driver)" />
      </include>
    </group>


    <!-- nodelet manager -->
    <arg name="manager" default="lidar_nodelet_manager" />
    <node pkg="nodelet" type="nodelet" name="$(arg manager)" args="manager" />

    <!-- PointCloud Concat Filter -->
    <node pkg="nodelet" type="nodelet" name="concatenate_filter" args="load pcl/PointCloudConcatenateDataSynchronizer $(arg manager)">
      <rosparam param="input_topics" subst_value="true">
        [/sensing/lidar/top/rectified/pointcloud,
        /sensing/lidar/left/rectified/pointcloud,
        /sensing/lidar/right/rectified/pointcloud]
      </rosparam>
      <remap from="~output" to="concatenated/pointcloud" />
      <param name="output_frame" value="base_link" />
      <param name="approximate_sync" value="true" />
    </node>

    <!-- PointCloud Ground Filter -->
    <node pkg="nodelet" type="nodelet" name="ray_ground_filter" args="load pointcloud_preprocessor/ray_ground_filter_nodelet $(arg manager)">
      <remap from="~input" to="top/rectified/pointcloud" />
      <remap from="~output" to="no_ground/pointcloud" />
    </node>

    <!-- Relay -->
    <node pkg="topic_tools" type="relay" name="relay" args="/sensing/lidar/top/rectified/pointcloud /sensing/lidar/pointcloud" />

  </group>
</launch>
